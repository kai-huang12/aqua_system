<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>é­šå¡­ç›£æ§ç³»çµ±</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>
    <script>
function updateQueryParam(param, value) {
    const url = new URL(window.location.href);
    url.searchParams.set(param, value);
    window.location.href = url.href;
}
</script>

</head>
<body>

<div class="header-bar">
  <h1><span id="fish-icon">ğŸŸ</span> é­šå¡­ç›£æ§è³‡è¨Š</h1>
  <img src="{{ url_for('static', filename='banner.png') }}" alt="é­šå¡­ Banner" class="header-banner">
</div>


    <section>
        <h2>æœ€æ–°æ„Ÿæ¸¬è³‡æ–™</h2>
        <ul>
            <li><strong>æ™‚é–“ï¼š</strong>{{ sensor[1] }}</li>
            <li><strong>æº«åº¦ï¼š</strong>{{ sensor[2] }} Â°C</li>
            <li><strong>æ¿åº¦ï¼š</strong>{{ sensor[3] }} NTU</li>
        </ul>
    </section>

<form>
  <label for="feed_count">é¸æ“‡é¤µé£Ÿç´€éŒ„ç­†æ•¸ï¼š</label>
  <select id="feed_count" onchange="updateQueryParam('feed_count', this.value)">
    <option value="5" {% if feed_count == 5 %}selected{% endif %}>5 ç­†</option>
    <option value="10" {% if feed_count == 10 %}selected{% endif %}>10 ç­†</option>
    <option value="20" {% if feed_count == 20 %}selected{% endif %}>20 ç­†</option>
    <option value="50" {% if feed_count == 50 %}selected{% endif %}>50 ç­†</option>
  </select>
</form>



    <section>
        <h2>è¿‘æœŸé¤µé£Ÿç´€éŒ„</h2>
        <table>
            <thead>
                <tr>
                    <th>æ™‚é–“</th>
                    <th>æº«åº¦ (Â°C)</th>
                    <th>æ¿åº¦ (NTU)</th>
                </tr>
            </thead>
            <tbody>
                {% for row in logs %}
                <tr>
                    <td>{{ row[1] }}</td>
                    <td>{{ row[2] }}</td>
                    <td>{{ row[3] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
<form method="get" style="margin-top: 10px;">
    <label for="count">é¸æ“‡é¡¯ç¤ºè³‡æ–™ç­†æ•¸ï¼š</label>
    <select name="count" id="count" onchange="this.form.submit()">
        <option value="5" {% if count == 5 %}selected{% endif %}>5 ç­†</option>
        <option value="10" {% if count == 10 %}selected{% endif %}>10 ç­†</option>
        <option value="20" {% if count == 20 %}selected{% endif %}>20 ç­†</option>
        <option value="50" {% if count == 50 %}selected{% endif %}>50 ç­†</option>
    </select>
</form>


    <section>
        <h2>æ°´æº«è¶¨å‹¢åœ–ï¼ˆTemperatureï¼‰</h2>
        <canvas id="tempChart" height="100"></canvas>
    </section>


<form>
  <label for="turb_count">é¸æ“‡æ¿åº¦è³‡æ–™ç­†æ•¸ï¼š</label>
  <select id="turb_count" onchange="updateQueryParam('turb_count', this.value)">
    <option value="5" {% if turb_count == 5 %}selected{% endif %}>5 ç­†</option>
    <option value="10" {% if turb_count == 10 %}selected{% endif %}>10 ç­†</option>
    <option value="20" {% if turb_count == 20 %}selected{% endif %}>20 ç­†</option>
    <option value="50" {% if turb_count == 50 %}selected{% endif %}>50 ç­†</option>
  </select>
</form>


    <section>
        <h2>æ¿åº¦è¶¨å‹¢åœ–ï¼ˆTurbidityï¼‰</h2>
        <canvas id="turbChart" height="100"></canvas>
    </section>

    <script>
        const labels = {{ times | tojson }};
        const tempData = {{ temps | tojson }};
        const turbData = {{ turbs | tojson }};

        // æº«åº¦åœ–è¡¨
        const tempChart = new Chart(document.getElementById('tempChart').getContext('2d'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'æº«åº¦ (Â°C)',
            data: tempData,
            borderColor: 'black',        // å›ºå®šç·šæ¢ç‚ºé»‘
            tension: 0,
            pointRadius: 5,
            pointBackgroundColor: tempData.map(val => {
                if (val > 30) return 'red';
                if (val < 24) return 'blue';
                return 'black';
            }),
            fill: false
        }]
    },
    options: {
        responsive: true,
        plugins: {
  title: {
    display: true,
    text: 'æœ€è¿‘æ°´æº«è®ŠåŒ–',
    font: { size: 16 }
  },
  legend: {
    display: true,
    position: 'top'
  },
  annotation: {
    annotations: {
      highTemp: {
        type: 'box',
        yMin: 30,
        yMax: 40,
        backgroundColor: 'rgba(255, 99, 132, 0.1)',
        borderWidth: 0
      },
      lowTemp: {
        type: 'box',
        yMin: 0,
        yMax: 24,
        backgroundColor: 'rgba(54, 162, 235, 0.1)',
        borderWidth: 0
      }
    }
  }
}


,
        scales: {
            x: { title: { display: true, text: 'æ™‚é–“' } },
            y: { title: { display: true, text: 'æº«åº¦ (Â°C)' },
    min: 15,
    max: 40 }
        }
    }
});



        // æ¿åº¦åœ–è¡¨
        
const turbChart = new Chart(document.getElementById('turbChart').getContext('2d'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'æ¿åº¦ (NTU)',
            data: turbData,
            borderColor: 'rgb(54, 162, 235)',
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            fill: true,
            tension: 0.3,

            // âœ… å¯¦å¿ƒåœ“è¨­å®šï¼ˆæ–°å¢é€™å…©è¡Œï¼‰
            pointRadius: 5,
            pointBackgroundColor: turbData.map(val => val > 50 ? 'red' : 'black'),
            pointBorderColor: turbData.map(val => val > 50 ? 'red' : 'black'),
            pointBorderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: { display: true, text: 'æ¿åº¦è¶¨å‹¢è®ŠåŒ–' },
            legend: { display: true }
        },
        scales: {
            x: { title: { display: true, text: 'æ™‚é–“' } },
            y: { title: { display: true, text: 'æ¿åº¦ (NTU)' }, beginAtZero: true }
        }
    }
});



    </script>


   <script>
document.addEventListener("DOMContentLoaded", function() {
  const fish = document.getElementById("fish-icon");
  fish.addEventListener("click", function() {
    fish.classList.add("fish-spin");
    setTimeout(() => {
      fish.classList.remove("fish-spin");
    }, 1000);
  });
});
</script>








<!-- index.html çµå°¾å‰ -->

<footer class="site-footer">
  <div class="footer-column">
    <h3>ç³»çµ±æ™‚é–“</h3>
    <ul>

      <li>ç³»çµ±æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š</li>
      <li id="current-time">{{ latest_time }}</li>
    </ul>
  </div>
  <div class="footer-column">
    <h3>æœ€æ–°æ¶ˆæ¯</h3>
    <ul>
      <li>ç³»çµ±è³‡æ–™æ›´æ–°å®Œæˆï¼ˆ2025/06/03ï¼‰</li>
      <li>æ–°å¢åœ–è¡¨é¡è‰²ç¯„åœï¼ˆ2025/05/28ï¼‰</li>
    </ul>
  </div>
  <div class="footer-column">
    <h3>è¯çµ¡æˆ‘å€‘</h3>
    <ul>
      <li>Emailï¼šsupport@fishpond.com</li>
      <li>é–‹ç™¼è€…ï¼šå”±KéŠ€é¾é­š</li>
      <li>åœ°å€ï¼šå°ç£å°ä¸­å¸‚é­šå¡­è·¯88è™Ÿ</li>
    </ul>
  </div>
  <div class="footer-column">
    <h3>é—œæ–¼æœ¬ç³»çµ±</h3>
    <ul>
      <li>å³æ™‚ç›£æ¸¬æº«åº¦èˆ‡æ¿åº¦</li>
      <li>Flask + Chart.js è£½ä½œ</li>
      <li>ç‰ˆæœ¬ï¼š1.0</li>
      <li>Â© 2025 FishPond System</li>
    </ul>
  </div>
</footer>

</body>
</html>







